@import 'colors.scss';

@font-face {
  font-family: 'Bentham Regular';
  font-style: normal;
  font-weight: normal;
  src: url('assets/Bentham Regular.ttf') format('truetype');
}

@font-face {
  font-family: 'Carnevalee Freakshow';
  font-style: normal;
  font-weight: normal;
  src: url('assets/Carnevalee Freakshow.ttf') format('truetype');
}

:root {
  // NOTE: these set in geometry.ts
  --map-clip-x: 0;
  --map-clip-y: 0;
  --map-clip-cx: 0;
  --map-clip-cy: 0;
  --map-cxNominal: 0;
  --map-cyNominal: 0;
  --map-cxTile: 0;
  --map-cyTile: 0;
  --map-numHGrids: 0;
  --map-numVGrids: 0;
  --map-numXTiles: 0;
  --map-numYTiles: 0;
  --map-scale-cxUnit: 0;
  --map-scale-cxWidth: 0;

  // NOTE: these apply to the thumbnail
  --thumbnail-clip-x: 0;
  --thumbnail-clip-y: 0;
  --thumbnail-clip-cx: 0;
  --thumbnail-clip-cy: 0;
  --thumbnail-cxNominal: 0;
  --thumbnail-cyNominal: 0;
  --thumbnail-cxTile: 0;
  --thumbnail-cyTile: 0;
  --thumbnail-numHGrids: 0;
  --thumbnail-numVGrids: 0;
  --thumbnail-numXTiles: 0;
  --thumbnail-numYTiles: 0;

  // NOTE: these apply to the county map in the thumbnail
  --sullivan-clip-x: 0;
  --sullivan-clip-y: 0;
  --sullivan-clip-cx: 0;
  --sullivan-clip-cy: 0;
  --sullivan-cxNominal: 0;
  --sullivan-cyNominal: 0;
  --sullivan-cxTile: 0;
  --sullivan-cyTile: 0;
  --sullivan-numHGrids: 0;
  --sullivan-numVGrids: 0;
  --sullivan-numXTiles: 0;
  --sullivan-numYTiles: 0;

  // NOTE: these apply to the state map in the thumbnail
  --nh-clip-x: 0;
  --nh-clip-y: 0;
  --nh-clip-cx: 0;
  --nh-clip-cy: 0;
  --nh-cxNominal: 0;
  --nh-cyNominal: 0;
  --nh-cxTile: 0;
  --nh-cyTile: 0;
  --nh-numHGrids: 0;
  --nh-numVGrids: 0;
  --nh-numXTiles: 0;
  --nh-numYTiles: 0;

  // land use color shading
  // @see https://www.gismanual.com/style/ColorConventions.pdf
  --shade-u11: var(--rgb-brown-300);
  --shade-u12: var(--rgb-brown-500);
  --shade-u17: var(--rgb-red-200);
  --shade-u19: var(--rgb-yellow-200);
  --shade-u22: var(--rgb-orange-200);
  --shade-u26: var(--rgb-purple-200);
  --shade-u27: var(--rgb-gray-300);
  --shade-u33: var(--rgb-blue-200);
  --shade-u58: var(--rgb-teal-200);
  --shade-u100: 190, 219, 75; // #BEDBAF
  --shade-u101: 170, 204, 155; // #aacc9b
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

:focus {
  outline: 0;
}

body {
  background-color: white;
  display: grid;
  height: 100%;
  overflow: hidden;
  place-content: center;
  user-select: none;
  width: 100%;
}

html {
  border: 0;
  height: 100%;
  width: 100%;
}

map-root {
  background-color: white;
  display: block;
  height: 100%;
  overflow: auto;
  position: relative;
  width: 100%;

  &.printing {
    cursor: wait;
    overflow: unset;
  }

  &.withLegend {
    display: grid;
    grid-template-columns: auto auto;
  }

  //////////////////////////////////////////////////////////////////////////////
  //////////////////////////////////////////////////////////////////////////////
  // SIDEBAR LEGEND
  //////////////////////////////////////////////////////////////////////////////
  //////////////////////////////////////////////////////////////////////////////

  aside {
    color: var(--mat-gray-900);
    display: block;
    height: 100%;
    // TODO: total hack
    // we need the w x h to be 4:3
    // so: 4849 (map) + 1636 (legend) = width of 6465
    // and: 4836 (map) = height
    // therefore aspect ratio of 1.33
    padding: 64px 385px;
    width: 1636px;

    map-legend {
      align-content: start;
      display: grid;
      font-family: 'Bentham Regular', sans-serif;
      font-size: 32px;
      grid-row-gap: 96px;
      grid-template-columns: 1fr;
      grid-template-rows: auto auto auto auto auto 1fr;
      height: 100%;
      justify-content: center;

      article.grids {
        display: grid;
        grid-column-gap: 64px;
        grid-row-gap: 16px;
        grid-template-columns: 1fr 1fr 1fr;
        grid-template-rows: auto 1fr auto;

        figure {
          aspect-ratio: 1 / 1;
          background-color: var(--mat-gray-800);
          border: 1px solid var(--mat-gray-800);
          box-sizing: content-box;
          display: grid;
          font-size: 16px;
          grid-gap: 1px;
          grid-template-columns: 1fr 1fr;
          grid-template-rows: 1fr 1fr;
          width: 100%;

          div {
            background-color: white;
            display: grid;
            place-content: center;
            text-align: center;
          }
        }

        figcaption {
          font-size: 24px;
          font-weight: bold;
          text-align: center;
        }

        h2 {
          grid-column: 1 / 4;
        }
      }

      footer {
        align-content: end;
        display: grid;
        font-size: 16px;
        text-align: center;
      }

      header {
        font-family: 'Carnevalee Freakshow', sans-serif;
        text-align: center;

        h1 {
          font-size: 96px;
          font-weight: normal;
        }

        h2 {
          font-size: 64px;
          font-weight: normal;
        }
      }

      map-state {
        --thumbnail-clip-x: var(--nh-clip-x);
        --thumbnail-clip-y: var(--nh-clip-y);
        --thumbnail-clip-cx: var(--nh-clip-cx);
        --thumbnail-clip-cy: var(--nh-clip-cy);
        --thumbnail-cxNominal: var(--nh-cxNominal);
        --thumbnail-cyNominal: var(--nh-cyNominal);
        --thumbnail-cxTile: var(--nh-cxTile);
        --thumbnail-cyTile: var(--nh-cyTile);
        --thumbnail-numHGrids: var(--nh-numHGrids);
        --thumbnail-numVGrids: var(--nh-numVGrids);
        --thumbnail-numXTiles: var(--nh-numXTiles);
        --thumbnail-numYTiles: var(--nh-numYTiles);
      }

      map-county {
        --thumbnail-clip-x: var(--sullivan-clip-x);
        --thumbnail-clip-y: var(--sullivan-clip-y);
        --thumbnail-clip-cx: var(--sullivan-clip-cx);
        --thumbnail-clip-cy: var(--sullivan-clip-cy);
        --thumbnail-cxNominal: var(--sullivan-cxNominal);
        --thumbnail-cyNominal: var(--sullivan-cyNominal);
        --thumbnail-cxTile: var(--sullivan-cxTile);
        --thumbnail-cyTile: var(--sullivan-cyTile);
        --thumbnail-numHGrids: var(--sullivan-numHGrids);
        --thumbnail-numVGrids: var(--sullivan-numVGrids);
        --thumbnail-numXTiles: var(--sullivan-numXTiles);
        --thumbnail-numYTiles: var(--sullivan-numYTiles);
      }

      map-county,
      map-state {
        display: block;
        height: calc(var(--thumbnail-clip-cy));
        overflow: hidden;
        position: relative;
        width: calc(var(--thumbnail-clip-cx));

        figure {
          display: block;
          height: calc(var(--thumbnail-cyNominal));
          pointer-events: none;
          position: absolute;
          transform: translate(
            calc(var(--thumbnail-clip-x) * -1),
            calc(var(--thumbnail-clip-y) * -1)
          );
          width: calc(var(--thumbnail-cxNominal));

          map-boundary,
          map-defs,
          map-grid,
          map-street,
          map-tiles,
          map-topo {
            display: block;
            height: 100%;
            position: absolute;
            width: 100%;
          }

          map-boundary,
          map-grid {
            svg {
              height: 100%;
              width: 100%;
            }
          }

          map-boundary {
            fill: none;
            stroke: var(--mat-gray-800);
            stroke-dasharray: 4;
            stroke-width: 3;
          }

          map-boundary[boundary='sullivan'],
          map-boundary[boundary='washington'] {
            fill: rgba(var(--rgb-amber-900), 0.25);
            stroke: rgba(var(--rgb-amber-900), 0.75);
            stroke-width: 3;
          }

          map-grid {
            g path {
              fill: none;
              stroke: var(--mat-gray-800);
              stroke-width: 0.25;
            }
          }

          map-tile {
            display: inline-block;
            height: calc(var(--thumbnail-cyTile));
            position: relative;
            vertical-align: top;
            width: calc(var(--thumbnail-cxTile));

            canvas {
              height: var(--thumbnail-cyTile);
              position: absolute;
              visibility: hidden;
              width: var(--thumbnail-cxTile);
            }

            img {
              height: 100%;
              position: absolute;
              width: 100%;
            }

            img.inside {
              filter: none;
            }

            img.outside {
              filter: grayscale(1);
            }
          }
        }
      }

      table.usage {
        border-collapse: collapse;
        width: 100%;

        td {
          padding: 0.25rem;
        }

        td.desc {
          overflow: hidden;
          position: relative;
          width: 100%;

          &::after {
            content: '........................................................'
              '........................................................'
              '........................................................'
              '........................................................';
            position: absolute;
          }
        }

        td.usage {
          .lot {
            background-color: var(--mat-blue-gray-50);
            border: 3px dashed var(--mat-blue-gray-300);

            div {
              height: 2rem;
              width: 3rem;
            }

            .u11 /* Single family */ {
              background-color: rgba(var(--shade-u11), 0.5);
            }

            .u12 /* Multi family */ {
              background-color: rgba(var(--shade-u12), 0.5);
            }

            .u17 /* Manufacturing */ {
              background-color: rgba(var(--shade-u17), 0.5);
            }

            .u19 /* Improved residential */ {
              background-color: rgba(var(--shade-u19), 0.5);
            }

            .u22 /* Residential land */ {
              background-color: rgba(var(--shade-u22), 0.5);
            }

            .u26 /* Mixed use */ {
              background-color: rgba(var(--shade-u26), 0.5);
            }

            .u27 /* Unclassified */ {
              background-color: rgba(var(--shade-u27), 0.5);
            }

            .u33 /* Commercial */ {
              background-color: rgba(var(--shade-u33), 0.5);
            }

            .u58 /* Garage */ {
              background-color: rgba(var(--shade-u58), 0.5);
            }

            .u100 /* State Park */ {
              background-color: rgba(var(--shade-u100), 0.5);
            }

            .u101 /* Town Forest */ {
              background-color: rgba(var(--shade-u101), 1);
            }
          }
        }

        td.numeric {
          text-align: right;
        }

        thead td {
          font-weight: bold;
          text-transform: uppercase;
        }

        tr.total {
          td {
            font-weight: bold;
            text-transform: uppercase;
          }
        }
      }
    }
  }

  //////////////////////////////////////////////////////////////////////////////
  //////////////////////////////////////////////////////////////////////////////
  // MAP ITSELF
  //////////////////////////////////////////////////////////////////////////////
  //////////////////////////////////////////////////////////////////////////////

  main {
    display: grid;

    map-border {
      .border-1 {
        border: 1px solid var(--mat-gray-600);
        margin: 64px;
      }

      .border-2 {
        background-color: var(--mat-gray-50);
        border: 16px dashed var(--mat-gray-600);
      }

      .border-3 {
        background-color: white;
        border: 1px solid var(--mat-gray-600);
        padding: 24px;
      }

      .border-1.hidden,
      .border-2.hidden,
      .border-3.hidden {
        border: none;
        margin: 0;
        padding: 0;
      }

      footer {
        color: var(--mat-gray-900);
        display: flex;
        font-family: 'Bentham Regular', sans-serif;
        font-size: 16px;
        justify-content: space-between;
        position: absolute;
        width: calc(var(--map-clip-cx));
      }
    }

    map-body {
      display: block;
      height: calc(var(--map-clip-cy));
      overflow: hidden;
      position: relative;
      width: calc(var(--map-clip-cx));

      figure {
        cursor: normal;
        display: block;
        height: calc(var(--map-cyNominal));
        pointer-events: none;
        position: absolute;
        transform: translate(
          calc(var(--map-clip-x) * -1),
          calc(var(--map-clip-y) * -1)
        );
        width: calc(var(--map-cxNominal));

        map-boundary,
        map-clip,
        map-defs,
        map-grid,
        map-lot-labels,
        map-lots,
        map-polygons,
        map-street,
        map-tiles,
        map-topo {
          display: block;
          height: 100%;
          position: absolute;
          width: 100%;
        }

        map-boundary,
        map-clip,
        map-grid,
        map-lot-labels,
        map-lots {
          svg {
            height: 100%;
            width: 100%;
          }
        }

        map-boundary {
          g polygon {
            fill: none;
            stroke: var(--mat-gray-800);
            stroke-dasharray: 4;
            stroke-width: 3;
          }
        }

        map-grid {
          g path {
            fill: none;
            stroke: var(--mat-gray-800);
            stroke-width: 0.25;
          }
        }

        map-indices {
          display: block;
          font-family: 'Ubuntu', sans-serif;
          font-size: 64px;
          font-weight: bold;
          position: absolute;
          text-transform: uppercase;

          article {
            border: 5px solid rgba(var(--rgb-gray-500), 0.5);
            color: rgba(var(--rgb-gray-500), 0.5);
            display: grid;
            place-items: center;
            position: absolute;
          }
        }

        map-lot-labels {
          g {
            line {
              stroke: var(--mat-gray-600);
              stroke-dasharray: 1;
              stroke-width: 1;
            }

            text {
              fill: var(--mat-gray-800);
              font-family: 'Ubuntu', sans-serif;
            }

            text tspan.area {
              font-size: 0.8em;
            }

            text tspan.id {
              font-size: 1em;
              font-weight: bold;
            }
          }

          g.z15 {
            line.a0,
            line.a1 {
              display: none;
            }

            text.a0,
            text.a1 {
              display: none;
            }

            text.a2 {
              font-size: 9px;
            }

            text.a5 {
              font-size: 10px;
            }

            text.a10 {
              font-size: 11px;
            }

            text.a25 {
              font-size: 12px;
            }

            text.a50 {
              font-size: 16px;
            }

            text.a100 {
              font-size: 20px;
            }

            text.a500 {
              font-size: 24px;
            }

            text.a2 tspan.area {
              display: none;
            }
          }

          g.z17 {
            text.a0 {
              font-size: 12px;
            }

            text.a1 {
              font-size: 16px;
            }

            text.a2 {
              font-size: 20px;
            }

            text.a5 {
              font-size: 24px;
            }

            text.a10 {
              font-size: 28px;
            }

            text.a25 {
              font-size: 32px;
            }

            text.a50 {
              font-size: 40px;
            }

            text.a100 {
              font-size: 48px;
            }

            text.a500 {
              font-size: 56px;
            }

            text.a0 tspan.area {
              display: none;
            }
          }
        }

        map-lots {
          clip-path: url(#boundary);
          pointer-events: auto;

          g path.black {
            fill: none;
            stroke: var(--mat-blue-gray-300);
            stroke-width: 2;
          }

          g path.white {
            fill: none;
            stroke: var(--mat-blue-gray-50);
            stroke-dasharray: 1, 4;
            stroke-width: 2;
          }

          g.z15 path {
            stroke-width: 2;

            &.white.u11 /* Single family */ {
              fill: rgba(var(--shade-u11), 0.5);
            }

            &.white.u12 /* Multi family */ {
              fill: rgba(var(--shade-u12), 0.5);
            }

            &.white.u17 /* Manufacturing */ {
              fill: rgba(var(--shade-u17), 0.5);
            }

            &.white.u19 /* Improved residential */ {
              fill: rgba(var(--shade-u19), 0.5);
            }

            &.white.u22 /* Residential land */ {
              fill: rgba(var(--shade-u22), 0.5);
            }

            &.white.u26 /* Mixed use */ {
              fill: rgba(var(--shade-u26), 0.5);
            }

            &.white.u27 /* Unclassified */ {
              fill: rgba(var(--shade-u27), 0.5);
            }

            &.white.u33 /* Commercial */ {
              fill: rgba(var(--shade-u33), 0.5);
            }

            &.white.u58 /* Garage */ {
              fill: rgba(var(--shade-u58), 0.5);
            }

            &.white.u100 /* State Park */ {
              fill: rgba(var(--shade-u100), 0.5);
            }

            &.white.u101 /* Town Forest */ {
              fill: rgba(var(--shade-u101), 1);
            }
          }

          g.z17 path {
            stroke-width: 3;

            &.white.u11 /* Single family */ {
              fill: url(#halftone-u11);
            }

            &.white.u12 /* Multi family */ {
              fill: url(#halftone-u12);
            }

            &.white.u17 /* Manufacturing */ {
              fill: url(#halftone-u17);
            }

            &.white.u19 /* Improved residential */ {
              fill: url(#halftone-u19);
            }

            &.white.u22 /* Residential land */ {
              fill: url(#halftone-u22);
            }

            &.white.u26 /* Mixed use */ {
              fill: url(#halftone-u26);
            }

            &.white.u27 /* Unclassified */ {
              fill: url(#halftone-u27);
            }

            &.white.u33 /* Commercial */ {
              fill: url(#halftone-u33);
            }

            &.white.u58 /* Garage */ {
              fill: url(#halftone-u58);
            }

            &.white.u100 /* State Park */ {
              fill: url(#halftone-u100);
            }

            &.white.u101 /* Town Forest */ {
              fill: url(#halftone-u101);
            }
          }
        }

        map-polygons {
          g polygon {
            fill: none;
            stroke: none;
          }

          // NOTE: just for testing
          // g polygon[id='12-46'] {
          //   fill: red;
          //   stroke: none;
          // }
        }

        map-tile {
          display: inline-block;
          height: calc(var(--map-cyTile));
          position: relative;
          vertical-align: top;
          width: calc(var(--map-cxTile));

          canvas {
            height: var(--map-cyTile);
            position: absolute;
            visibility: hidden;
            width: var(--map-cxTile);
          }

          img {
            height: 100%;
            position: absolute;
            width: 100%;
          }

          img.inside {
            filter: none;
          }

          img.outside {
            filter: grayscale(1);
          }
        }
      }

      map-scale {
        bottom: 64px;
        display: block;
        position: absolute;
        right: 64px;

        .annotations {
          bottom: 24px;
          display: flex;
          height: 24px;
          position: absolute;
          right: calc(var(--map-scale-cxUnit) / 2 * -1);
          width: calc(var(--map-scale-cxWidth) + var(--map-scale-cxUnit));
        }

        .annotation {
          color: var(--mat-gray-900);
          font-family: 'Ubuntu', sans-serif;
          font-size: 16px;
          text-align: center;
          width: var(--map-scale-cxUnit);
        }

        .units {
          border: 1px solid var(--mat-gray-600);
          bottom: 0;
          display: flex;
          height: 24px;
          position: absolute;
          right: 0;
          width: var(--map-scale-cxWidth);
        }

        .unit {
          width: var(--map-scale-cxUnit);
        }

        .unit.black {
          background-color: var(--mat-gray-600);
        }

        .unit.white {
          background-color: var(--mat-gray-50);
        }
      }
    }
  }
}
